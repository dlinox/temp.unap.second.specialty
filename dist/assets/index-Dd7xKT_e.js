var z=Object.defineProperty;var H=(i,n,u)=>n in i?z(i,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[n]=u;var k=(i,n,u)=>(H(i,typeof n!="symbol"?n+"":n,u),u);import{d as F,i as J,r as d,o as I,j as S,a,w as o,e as A,u as m,k as X,l as G,m as B,f as g,c as $,n as U,p as P,t as K,g as C,b as Q,F as W,q as h}from"./index-CRzd0Gft.js";import{P as Z,F as ee,_ as ae}from"./FileService-CoLsePyd.js";import{i as V,a as le,b as te,c as oe,d as ne,V as ue}from"./VForm-CgDOWgDI.js";import{a as se,V as re,b as R}from"./VSelect-CkeF8ACv.js";import{V as _,a as ie,b as c,c as b,e as de,d as me}from"./VTextField-DvkrkcSI.js";class ce{constructor(){k(this,"http");const n="http://174.138.178.198:8090/api";this.http=se.create({baseURL:n,headers:{"Content-Type":"application/json"}})}async store(n){const u={secuencia:n.paymentId,monto:n.paymentAmount,fecha_pago:n.paymentDate,image_url:n.fileId,id_postulante:n.postulantId};return(await this.http.post("/pago",u)).data}async updateImageUrl(n,u){return(await this.http.put(`/update-image-url/${n}`,{imageUrl:u})).data}}const pe=h("small",null," Voucher ",-1),ve=h("small",null," Ejemplo",-1),fe={key:0,class:"text-error ms-2"},ye=h("small",null,"Ya inicio la preinscripcion",-1),ge=h("p",null,"Ya inicio la preinscripcion, desea continuar?",-1),Ve=F({__name:"PostulantVoucher",emits:["onSuccess"],setup(i,{emit:n}){const u=J(),r=d(!1),T=new Z,j=new ce,q=new ee,w=d(null),N=d(!1),v=d(!1),y=d(""),L=[{id:"001",name:"DOCUMENTO NACIONAL DE IDENTIDAD",shortName:"DNI"},{id:"004",name:"CARNET/CARNÉ DE EXTRANJERÍA",shortName:"CE"}],x=d(null),t=d({documentType:"001",documentNumber:"",paymentId:"",paymentDate:"",paymentAmount:"",paymentVoucher:null,postulantId:null,fileId:null}),f=d(""),M=s=>(f.value="",s?["image/jpeg","image/png","image/jpg","image/gif","image/svg","image/webp"].includes(s.type)?s.size>2e6?"El tamaño de la imagen no debe superar los 2MB":"":"Solo se permiten archivos de imagen (jpeg, png)":"El archivo es requerido"),D=async s=>{if(y.value="",s.length===8&&t.value.documentType==="001"){let e=await T.searchPostulantByDocument(t.value.documentType,s);e&&(y.value=e,v.value=!0)}else if(s.length===12&&t.value.documentType==="004"){let e=await T.searchPostulantByDocument(t.value.documentType,s);e&&(y.value=e,v.value=!0)}},O=()=>{u.push(`/convocatoria-2024/preinscripcion/${y.value}`)},Y=async()=>{const{valid:s}=await x.value.validate();if(t.value.paymentVoucher===null){f.value="El archivo es requerido";return}if(f.value=M(t.value.paymentVoucher),!!s){r.value=!0;try{let e=await T.startPreinscription(t.value);if(e.error){console.log(e),r.value=!1;return}t.value.postulantId=e.id;let l=await q.store(t.value);if(l.error){console.log(l),r.value=!1;return}t.value.fileId=l.FileId;let p=await j.updateImageUrl(e.paymentId,l.Path);if(p.error){console.log(p),E(e.id,p.paymentId,l.Id),r.value=!1;return}console.log(p),p!==!0?(r.value=!1,E(e.id,p.paymentId,l.Id)):(r.value=!1,u.push(`/convocatoria-2024/preinscripcion/${t.value.postulantId}`))}catch(e){r.value=!1,console.log(e)}}},E=(s,e,l)=>{console.log("rollback",s,e,l),console.log("rollback")};return(s,e)=>(I(),S(W,null,[a(ue,{ref_key:"formRef",ref:x,onSubmit:Q(Y,["prevent"])},{default:o(()=>[a(_,{"max-width":"450",class:"mx-auto my-5",rounded:"lg",elevation:"2"},{default:o(()=>[a(A,null,{default:o(()=>[a(ie,{class:"mt-2"},{default:o(()=>[a(c,{cols:"12",md:"4"},{default:o(()=>[a(re,{modelValue:t.value.documentType,"onUpdate:modelValue":[e[0]||(e[0]=l=>t.value.documentType=l),e[1]||(e[1]=l=>D(t.value.documentNumber))],items:L,label:"Tipo de documento","item-title":"shortName","item-value":"id",rules:[m(V)],density:"compact"},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"8",class:"pb-0"},{default:o(()=>[a(b,{modelValue:t.value.documentNumber,"onUpdate:modelValue":[e[2]||(e[2]=l=>t.value.documentNumber=l),D],label:"N° de documento",required:"",rules:[t.value.documentType==="001"?m(le):m(te)],autocomplete:"off",counter:t.value.documentType==="001"?8:12,maxLength:t.value.documentType==="001"?8:12},null,8,["modelValue","rules","counter","maxLength"])]),_:1}),a(c,{cols:"12",md:"12"},{default:o(()=>[a(b,{modelValue:t.value.paymentId,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.paymentId=l),label:"Serie",rules:[m(V),m(oe)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:o(()=>[a(b,{modelValue:t.value.paymentDate,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.paymentDate=l),label:"Fecha",type:"date",rules:[m(V)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:o(()=>[a(b,{modelValue:t.value.paymentAmount,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.paymentAmount=l),label:"Monto",rules:[m(V),m(ne)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:o(()=>[a(X,{density:"compact"},{default:o(()=>[a(G,null,{default:o(()=>[pe]),_:1}),a(B),a(g,{"prepend-icon":"mdi-information-variant-circle-outline",density:"compact",onClick:e[6]||(e[6]=l=>N.value=!0)},{default:o(()=>[ve]),_:1})]),_:1}),a(_,{variant:"tonal",rounded:"0"},{default:o(()=>[a(ae,{"aspect-ratio":1,onOnCropper:e[7]||(e[7]=l=>(w.value=l.blob,t.value.paymentVoucher=l.file))}),w.value?(I(),$(U,{key:0,"aspect-ratio":16/9,src:w.value,height:"250",class:"border"},null,8,["src"])):P("",!0)]),_:1}),f.value?(I(),S("small",fe,K(f.value),1)):P("",!0)]),_:1}),a(c,{cols:"12"},{default:o(()=>[a(g,{type:"submit",variant:"flat",block:"",loading:r.value},{default:o(()=>[C(" Iniciar preinscripción ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),a(R,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=l=>N.value=l)},{default:o(()=>[a(_,{width:"300px",class:"mx-auto"},{default:o(()=>[a(U,{src:"http://www.osce.gob.pe/consultasenlinea/rnp/images/ClaveBANBIF.gif"})]),_:1})]),_:1},8,["modelValue"]),a(R,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value=l)},{default:o(()=>[a(_,{width:"300px",class:"mx-auto"},{default:o(()=>[a(de,{class:"bg-primary"},{default:o(()=>[ye]),_:1}),a(A,null,{default:o(()=>[ge]),_:1}),a(me,null,{default:o(()=>[a(g,{color:"red",onClick:e[9]||(e[9]=l=>v.value=!1)},{default:o(()=>[C("No")]),_:1}),a(B),a(g,{variant:"tonal",onClick:O},{default:o(()=>[C("Si")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ne=F({__name:"index",setup(i){return(async()=>{})(),(u,r)=>(I(),$(Ve))}});export{Ne as default};
