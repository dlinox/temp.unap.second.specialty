var Y=Object.defineProperty;var z=(i,n,u)=>n in i?Y(i,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[n]=u;var D=(i,n,u)=>(z(i,typeof n!="symbol"?n+"":n,u),u);import{d as P,h as G,r,o as b,i as E,a as e,w as l,u as d,j as H,k as J,l as k,e as y,c as R,m as A,n as S,t as X,f as N,b as K,F as Q,p as I,V as W,g as Z}from"./index-fRvBsB6r.js";import{P as ee,F as ae,_ as te}from"./FileService-BIMhxIBH.js";import{i as V,a as le,b as oe,c as ne,V as ue}from"./VForm-Bgve73ik.js";import{a as se,V as ie,b as B}from"./VSelect-Ckl7Chwe.js";import{V as g,a as U,b as re,c as m,d as _,f as de,e as me}from"./VTextField-ByuMKWJX.js";class pe{constructor(){D(this,"http");const n="http://174.138.178.198:8090/api";this.http=se.create({baseURL:n,headers:{"Content-Type":"application/json"}})}async store(n){const u={secuencia:n.paymentId,monto:n.paymentAmount,fecha_pago:n.paymentDate,image_url:n.fileId,id_postulante:n.postulantId};return(await this.http.post("/pago",u)).data}async updateImageUrl(n,u){return(await this.http.put(`/update-image-url/${n}`,{imageUrl:u})).data}}const ce=I("small",null," Voucher ",-1),ve=I("small",null," Ejemplo",-1),fe={key:0,class:"text-error ms-2"},ye=I("small",null,"Ya inicio la preinscripcion",-1),Ve=I("p",null,"Ya inicio la preinscripcion, desea continuar?",-1),ge=P({__name:"PostulantVoucher",emits:["onSuccess"],setup(i,{emit:n}){const u=G(),p=new ee,F=new pe,$=new ae,h=r(null),T=r(!1),c=r(!1),f=r(""),j=[{id:"001",name:"DOCUMENTO NACIONAL DE IDENTIDAD",shortName:"DNI"},{id:"004",name:"CARNET/CARNÉ DE EXTRANJERÍA",shortName:"CE"}],C=r(null),t=r({documentType:"001",documentNumber:"",paymentId:"",paymentDate:"",paymentAmount:"",paymentVoucher:null,postulantId:null,fileId:null}),v=r(""),M=s=>(v.value="",s?["image/jpeg","image/png","image/jpg","image/gif","image/svg","image/webp"].includes(s.type)?s.size>2e6?"El tamaño de la imagen no debe superar los 2MB":"":"Solo se permiten archivos de imagen (jpeg, png)":"El archivo es requerido"),x=async s=>{if(f.value="",s.length===8&&t.value.documentType==="001"){let a=await p.searchPostulantByDocument(t.value.documentType,s);a&&(f.value=a,c.value=!0)}else if(s.length===12&&t.value.documentType==="004"){let a=await p.searchPostulantByDocument(t.value.documentType,s);a&&(f.value=a,c.value=!0)}},q=()=>{u.push(`/p/convocatoria-2024/preinscripcion/${f.value}`)},L=async()=>{const{valid:s}=await C.value.validate();if(t.value.paymentVoucher===null){v.value="El archivo es requerido";return}if(v.value=M(t.value.paymentVoucher),!s)return;let a=await p.startPreinscription(t.value);t.value.postulantId=a.id;let o=await $.store(t.value);t.value.fileId=o.FileId,console.log(o);let w=await F.updateImageUrl(a.paymentId,o.Path);console.log(w),w!==!0?O(a.id,w.paymentId,o.Id):(u.push(`/p/convocatoria-2024/preinscripcion/${t.value.postulantId}`),console.log(t.value.postulantId))},O=(s,a,o)=>{console.log("rollback",s,a,o),console.log("rollback")};return(s,a)=>(b(),E(Q,null,[e(ue,{ref_key:"formRef",ref:C,class:"w-full",onSubmit:K(L,["prevent"])},{default:l(()=>[e(g,{width:"450",class:"mx-auto",rounded:"0",elevation:"0"},{default:l(()=>[e(U,null,{default:l(()=>[e(re,{class:"mt-2"},{default:l(()=>[e(m,{cols:"12",md:"4"},{default:l(()=>[e(ie,{modelValue:t.value.documentType,"onUpdate:modelValue":[a[0]||(a[0]=o=>t.value.documentType=o),a[1]||(a[1]=o=>x(t.value.documentNumber))],items:j,label:"Tipo de documento","item-title":"shortName","item-value":"id",rules:[d(V)],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"8",class:"pb-0"},{default:l(()=>[e(_,{modelValue:t.value.documentNumber,"onUpdate:modelValue":[a[2]||(a[2]=o=>t.value.documentNumber=o),x],label:"N° de documento",required:"",rules:[t.value.documentType==="001"?d(le):d(oe)],autocomplete:"off",counter:t.value.documentType==="001"?8:12,maxLength:t.value.documentType==="001"?8:12},null,8,["modelValue","rules","counter","maxLength"])]),_:1}),e(m,{cols:"12",md:"12"},{default:l(()=>[e(_,{modelValue:t.value.paymentId,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.paymentId=o),label:"Serie",rules:[d(V),d(ne)]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"12"},{default:l(()=>[e(_,{modelValue:t.value.paymentDate,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.paymentDate=o),label:"Fecha",type:"date",rules:[d(V)]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"12"},{default:l(()=>[e(_,{modelValue:t.value.paymentAmount,"onUpdate:modelValue":a[5]||(a[5]=o=>t.value.paymentAmount=o),label:"Monto",rules:[d(V)]},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"12"},{default:l(()=>[e(H,{density:"compact"},{default:l(()=>[e(J,null,{default:l(()=>[ce]),_:1}),e(k),e(y,{"prepend-icon":"mdi-information-variant-circle-outline",density:"compact",onClick:a[6]||(a[6]=o=>T.value=!0)},{default:l(()=>[ve]),_:1})]),_:1}),e(g,{variant:"tonal",rounded:"0"},{default:l(()=>[e(te,{"aspect-ratio":1,onOnCropper:a[7]||(a[7]=o=>(h.value=o.blob,t.value.paymentVoucher=o.file))}),h.value?(b(),R(A,{key:0,"aspect-ratio":16/9,src:h.value,height:"250",class:"border"},null,8,["src"])):S("",!0)]),_:1}),v.value?(b(),E("small",fe,X(v.value),1)):S("",!0)]),_:1}),e(m,{cols:"12"},{default:l(()=>[e(y,{type:"submit",variant:"flat",block:""},{default:l(()=>[N(" Guardar ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),e(B,{modelValue:T.value,"onUpdate:modelValue":a[8]||(a[8]=o=>T.value=o)},{default:l(()=>[e(g,{width:"300px",class:"mx-auto"},{default:l(()=>[e(A,{src:"http://www.osce.gob.pe/consultasenlinea/rnp/images/ClaveBANBIF.gif"})]),_:1})]),_:1},8,["modelValue"]),e(B,{modelValue:c.value,"onUpdate:modelValue":a[10]||(a[10]=o=>c.value=o)},{default:l(()=>[e(g,{width:"300px",class:"mx-auto"},{default:l(()=>[e(de,{class:"bg-primary"},{default:l(()=>[ye]),_:1}),e(U,null,{default:l(()=>[Ve]),_:1}),e(me,null,{default:l(()=>[e(y,{color:"red",onClick:a[9]||(a[9]=o=>c.value=!1)},{default:l(()=>[N("No")]),_:1}),e(k),e(y,{variant:"tonal",onClick:q},{default:l(()=>[N("Si")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ne=P({__name:"index",setup(i){return(async()=>{})(),(u,p)=>(b(),R(W,{app:"",id:"inspire"},{default:l(()=>[e(Z,{app:"",class:"mt-10"},{default:l(()=>[e(ge)]),_:1})]),_:1}))}});export{Ne as default};
