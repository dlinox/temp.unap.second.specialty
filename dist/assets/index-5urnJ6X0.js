var z=Object.defineProperty;var H=(i,n,u)=>n in i?z(i,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[n]=u;var k=(i,n,u)=>(H(i,typeof n!="symbol"?n+"":n,u),u);import{p as J,d as F,k as X,r as m,o as h,i as S,a,w as t,e as A,u as d,l as G,q as K,s as B,f as g,c as $,v as U,x as P,t as Q,g as x,b as W,F as Z,j as I}from"./index-BkP5V-2G.js";import{P as ee,F as ae,_ as le}from"./FileService-CUribg-t.js";import{i as V,a as te,b as oe,c as ne,d as ue,V as se}from"./VForm-CvprXD42.js";import{V as _,a as re,b as c,e as ie,c as me}from"./VCard-DlnX821C.js";import{V as de,a as R}from"./VSelect-ecqEj8jk.js";import{V as b}from"./VTextField-CTCdQeIh.js";class ce{constructor(){k(this,"http");const n="http://174.138.178.198:8090/api";this.http=J.create({baseURL:n,headers:{"Content-Type":"application/json"}})}async store(n){const u={secuencia:n.paymentId,monto:n.paymentAmount,fecha_pago:n.paymentDate,image_url:n.fileId,id_postulante:n.postulantId};return(await this.http.post("/pago",u)).data}async updateImageUrl(n,u){return(await this.http.put(`/update-image-url/${n}`,{imageUrl:u})).data}}const pe=I("small",null," Voucher ",-1),ve=I("small",null," Ejemplo",-1),fe={key:0,class:"text-error ms-2"},ye=I("small",null,"Ya inicio la preinscripcion",-1),ge=I("p",null,"Ya inicio la preinscripcion, desea continuar?",-1),Ve=F({__name:"PostulantVoucher",emits:["onSuccess"],setup(i,{emit:n}){const u=X(),s=m(!1),T=new ee,j=new ce,q=new ae,w=m(null),N=m(!1),p=m(!1),f=m(""),L=[{id:"001",name:"DOCUMENTO NACIONAL DE IDENTIDAD",shortName:"DNI"},{id:"004",name:"CARNET/CARNÉ DE EXTRANJERÍA",shortName:"CE"}],D=m(null),l=m({documentType:"001",documentNumber:"",paymentId:"",paymentDate:"",paymentAmount:"",paymentVoucher:null,postulantId:null,fileId:null}),v=m(""),M=r=>(v.value="",r?["image/jpeg","image/png","image/jpg","image/gif","image/svg","image/webp"].includes(r.type)?r.size>2e6?"El tamaño de la imagen no debe superar los 2MB":"":"Solo se permiten archivos de imagen (jpeg, png)":"El archivo es requerido"),E=async r=>{if(f.value="",r.length===8&&l.value.documentType==="001"){let e=await T.searchPostulantByDocument(l.value.documentType,r);e&&(f.value=e,p.value=!0)}else if(r.length===12&&l.value.documentType==="004"){let e=await T.searchPostulantByDocument(l.value.documentType,r);e&&(f.value=e,p.value=!0)}},O=()=>{u.push(`/convocatoria-2024/preinscripcion/${f.value}`)},Y=async()=>{const{valid:r}=await D.value.validate();if(l.value.paymentVoucher===null){v.value="El archivo es requerido";return}if(v.value=M(l.value.paymentVoucher),!!r){s.value=!0;try{let e=await T.startPreinscription(l.value);if(e.error){console.log(e),s.value=!1;return}l.value.postulantId=e.id;let o=await q.store(l.value);if(o.error){console.log(o),s.value=!1,C();return}l.value.fileId=o.FileId;let y=await j.updateImageUrl(e.paymentId,o.Path);if(y.error){console.log(y),C(),s.value=!1;return}console.log(y),y!==!0?(s.value=!1,C()):(s.value=!1,u.push(`/convocatoria-2024/preinscripcion/${l.value.postulantId}`))}catch(e){s.value=!1,console.log(e)}}},C=()=>{console.log("rollback",l.value),console.log("rollback")};return(r,e)=>(h(),S(Z,null,[a(se,{ref_key:"formRef",ref:D,onSubmit:W(Y,["prevent"])},{default:t(()=>[a(_,{"max-width":"450",class:"mx-auto my-5",rounded:"lg",elevation:"2"},{default:t(()=>[a(A,null,{default:t(()=>[a(re,{class:"mt-2"},{default:t(()=>[a(c,{cols:"12",md:"4"},{default:t(()=>[a(de,{modelValue:l.value.documentType,"onUpdate:modelValue":[e[0]||(e[0]=o=>l.value.documentType=o),e[1]||(e[1]=o=>E(l.value.documentNumber))],items:L,label:"Tipo de documento","item-title":"shortName","item-value":"id",rules:[d(V)],density:"compact"},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"8",class:"pb-0"},{default:t(()=>[a(b,{modelValue:l.value.documentNumber,"onUpdate:modelValue":[e[2]||(e[2]=o=>l.value.documentNumber=o),E],label:"N° de documento",required:"",rules:[l.value.documentType==="001"?d(te):d(oe)],autocomplete:"off",counter:l.value.documentType==="001"?8:12,maxLength:l.value.documentType==="001"?8:12},null,8,["modelValue","rules","counter","maxLength"])]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(b,{modelValue:l.value.paymentId,"onUpdate:modelValue":e[3]||(e[3]=o=>l.value.paymentId=o),label:"Serie",rules:[d(V),d(ne)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(b,{modelValue:l.value.paymentDate,"onUpdate:modelValue":e[4]||(e[4]=o=>l.value.paymentDate=o),label:"Fecha",type:"date",rules:[d(V)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(b,{modelValue:l.value.paymentAmount,"onUpdate:modelValue":e[5]||(e[5]=o=>l.value.paymentAmount=o),label:"Monto",rules:[d(V),d(ue)]},null,8,["modelValue","rules"])]),_:1}),a(c,{cols:"12",md:"12"},{default:t(()=>[a(G,{density:"compact"},{default:t(()=>[a(K,null,{default:t(()=>[pe]),_:1}),a(B),a(g,{"prepend-icon":"mdi-information-variant-circle-outline",density:"compact",onClick:e[6]||(e[6]=o=>N.value=!0)},{default:t(()=>[ve]),_:1})]),_:1}),a(_,{variant:"tonal",rounded:"0"},{default:t(()=>[a(le,{"aspect-ratio":1,onOnCropper:e[7]||(e[7]=o=>(w.value=o.blob,l.value.paymentVoucher=o.file))}),w.value?(h(),$(U,{key:0,"aspect-ratio":16/9,src:w.value,height:"250",class:"border"},null,8,["src"])):P("",!0)]),_:1}),v.value?(h(),S("small",fe,Q(v.value),1)):P("",!0)]),_:1}),a(c,{cols:"12"},{default:t(()=>[a(g,{type:"submit",variant:"flat",block:"",loading:s.value},{default:t(()=>[x(" Iniciar preinscripción ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),a(R,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=o=>N.value=o)},{default:t(()=>[a(_,{width:"300px",class:"mx-auto"},{default:t(()=>[a(U,{src:"http://www.osce.gob.pe/consultasenlinea/rnp/images/ClaveBANBIF.gif"})]),_:1})]),_:1},8,["modelValue"]),a(R,{modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=o=>p.value=o)},{default:t(()=>[a(_,{width:"300px",class:"mx-auto"},{default:t(()=>[a(ie,{class:"bg-primary"},{default:t(()=>[ye]),_:1}),a(A,null,{default:t(()=>[ge]),_:1}),a(me,null,{default:t(()=>[a(g,{color:"red",onClick:e[9]||(e[9]=o=>p.value=!1)},{default:t(()=>[x("No")]),_:1}),a(B),a(g,{variant:"tonal",onClick:O},{default:t(()=>[x("Si")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),Ce=F({__name:"index",setup(i){return(async()=>{})(),(u,s)=>(h(),$(Ve))}});export{Ce as default};
