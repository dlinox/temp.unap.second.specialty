var J=Object.defineProperty;var X=(r,u,n)=>u in r?J(r,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[u]=n;var A=(r,u,n)=>(X(r,typeof u!="symbol"?u+"":u,n),n);import{p as G,d as $,k as K,q as Q,r as d,o as h,i as k,a as e,w as t,e as B,u as m,l as W,s as Z,v as R,c as j,x as U,y as P,t as ee,f as N,g as w,b as ae,F as le,j as C}from"./index-jQQbq741.js";import{P as te,F as oe,_ as ue}from"./FileService-D9clPKe6.js";import{i as g,a as ne,b as se,c as re,d as ie,V as de}from"./VForm-D70-mBzn.js";import{V,a as me,b as p,e as pe,c as ce}from"./VCard-DnWU2HZO.js";import{V as ve,a as F}from"./VSelect-DQLeLRnZ.js";import{V as _}from"./VTextField-BI4NDCG6.js";class fe{constructor(){A(this,"http");const u="https://data.segundas.unap.edu.pe/api";this.http=G.create({baseURL:u,headers:{"Content-Type":"application/json"}})}async store(u){const n={secuencia:u.paymentId,monto:u.paymentAmount,fecha_pago:u.paymentDate,image_url:u.fileId,id_postulante:u.postulantId};return(await this.http.post("/pago",n)).data}async updateImageUrl(u,n){return(await this.http.put(`/update-image-url/${u}`,{imageUrl:n})).data}}const ye=C("small",null," Voucher ",-1),ge={key:0,class:"text-error ms-2"},Ve=C("small",null,"Ya inicio la preinscripcion",-1),_e=C("p",null,"Ya inicio la preinscripcion,¿ desea continuar?",-1),he=$({__name:"PostulantVoucher",emits:["onSuccess"],setup(r,{emit:u}){const n=K(),c=Q(),i=d(!1),b=new te,q=new fe,L=new oe,I=d(null),x=d(!1),v=d(!1),y=d(""),M=[{id:"001",name:"DOCUMENTO NACIONAL DE IDENTIDAD",shortName:"DNI"},{id:"003",name:"CARNET/CARNÉ DE EXTRANJERÍA",shortName:"CE"}],D=d(null),l=d({documentType:"001",documentNumber:"",paymentId:"",paymentDate:"",paymentAmount:"",paymentVoucher:null,postulantId:null,fileId:null}),f=d(""),O=s=>(f.value="",s?["image/jpeg","image/png","image/jpg","image/gif","image/svg","image/webp"].includes(s.type)?s.size>2e6?"El tamaño de la imagen no debe superar los 2MB":"":"Solo se permiten archivos de imagen (jpeg, png)":"El archivo es requerido"),S=async s=>{if(y.value="",s.length===8&&l.value.documentType==="001"){let a=await b.searchPostulantByDocument(l.value.documentType,s);a&&(y.value=a,v.value=!0)}else if(s.length===12&&l.value.documentType==="004"){let a=await b.searchPostulantByDocument(l.value.documentType,s);a&&(y.value=a,v.value=!0)}},Y=()=>{let s=c.params.slug;n.push(`/${s}/preinscripcion/${y.value}`)},z=async()=>{const{valid:s}=await D.value.validate();if(l.value.paymentVoucher===null){f.value="El archivo es requerido";return}if(f.value=O(l.value.paymentVoucher),!!s){i.value=!0;try{let a=await b.startPreinscription(l.value);if(a.error){i.value=!1;return}l.value.postulantId=a.id;let o=await L.store(l.value);if(o.error){i.value=!1,T();return}l.value.fileId=o.FileId;let E=await q.updateImageUrl(a.paymentId,o.Path);if(E.error){T(),i.value=!1;return}if(E!==!0)i.value=!1,T();else{i.value=!1;let H=c.params.slug;n.push(`/${H}/preinscripcion/${l.value.postulantId}`)}}catch{i.value=!1}}},T=()=>{console.log("rollback")};return(s,a)=>(h(),k(le,null,[e(de,{ref_key:"formRef",ref:D,onSubmit:ae(z,["prevent"])},{default:t(()=>[e(V,{"max-width":"450",class:"mx-auto my-5",rounded:"lg",elevation:"2"},{default:t(()=>[e(B,null,{default:t(()=>[e(me,{class:"mt-2"},{default:t(()=>[e(p,{cols:"12",md:"4"},{default:t(()=>[e(ve,{modelValue:l.value.documentType,"onUpdate:modelValue":[a[0]||(a[0]=o=>l.value.documentType=o),a[1]||(a[1]=o=>S(l.value.documentNumber))],items:M,label:"Tipo de documento","item-title":"shortName","item-value":"id",rules:[m(g)],density:"compact"},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"8",class:"pb-0"},{default:t(()=>[e(_,{modelValue:l.value.documentNumber,"onUpdate:modelValue":[a[2]||(a[2]=o=>l.value.documentNumber=o),S],label:"N° de documento",required:"",rules:[l.value.documentType==="001"?m(ne):m(se)],autocomplete:"off",counter:l.value.documentType==="001"?8:12,maxLength:l.value.documentType==="001"?8:12},null,8,["modelValue","rules","counter","maxLength"])]),_:1}),e(p,{cols:"12",md:"12"},{default:t(()=>[e(_,{modelValue:l.value.paymentId,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.paymentId=o),label:"N° de operación del voucher",rules:[m(g),m(re)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"12"},{default:t(()=>[e(_,{modelValue:l.value.paymentDate,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.paymentDate=o),label:"Fecha de pago del voucher",type:"date",rules:[m(g)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"12"},{default:t(()=>[e(_,{modelValue:l.value.paymentAmount,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.paymentAmount=o),label:"Monto del voucher",rules:[m(g),m(ie)]},null,8,["modelValue","rules"])]),_:1}),e(p,{cols:"12",md:"12"},{default:t(()=>[e(W,{density:"compact"},{default:t(()=>[e(Z,null,{default:t(()=>[ye]),_:1}),e(R)]),_:1}),e(V,{variant:"tonal",rounded:"0"},{default:t(()=>[e(ue,{"aspect-ratio":1,onOnCropper:a[6]||(a[6]=o=>(I.value=o.blob,l.value.paymentVoucher=o.file))}),I.value?(h(),j(U,{key:0,"aspect-ratio":16/9,src:I.value,height:"250",class:"border"},null,8,["src"])):P("",!0)]),_:1}),f.value?(h(),k("small",ge,ee(f.value),1)):P("",!0)]),_:1}),e(p,{cols:"12"},{default:t(()=>[e(N,{type:"submit",variant:"flat",block:"",loading:i.value},{default:t(()=>[w(" Iniciar preinscripción ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),e(F,{modelValue:x.value,"onUpdate:modelValue":a[7]||(a[7]=o=>x.value=o)},{default:t(()=>[e(V,{width:"300px",class:"mx-auto"},{default:t(()=>[e(U,{src:"http://www.osce.gob.pe/consultasenlinea/rnp/images/ClaveBANBIF.gif"})]),_:1})]),_:1},8,["modelValue"]),e(F,{modelValue:v.value,"onUpdate:modelValue":a[9]||(a[9]=o=>v.value=o)},{default:t(()=>[e(V,{width:"300px",class:"mx-auto"},{default:t(()=>[e(pe,{class:"bg-primary"},{default:t(()=>[Ve]),_:1}),e(B,null,{default:t(()=>[_e]),_:1}),e(ce,null,{default:t(()=>[e(N,{color:"red",onClick:a[8]||(a[8]=o=>v.value=!1)},{default:t(()=>[w("No")]),_:1}),e(R),e(N,{variant:"tonal",onClick:Y},{default:t(()=>[w("Si")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}}),De=$({__name:"index",setup(r){return(async()=>{})(),(n,c)=>(h(),j(he))}});export{De as default};
