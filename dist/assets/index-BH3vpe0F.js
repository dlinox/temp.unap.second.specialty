var H=Object.defineProperty;var J=(i,o,s)=>o in i?H(i,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[o]=s;var x=(i,o,s)=>(J(i,typeof o!="symbol"?o+"":o,s),s);import{d as $,i as X,r as m,o as w,j as A,a,w as t,e as B,u as c,k as G,l as K,m as R,f as _,c as j,n as U,p as P,t as Q,g as D,b as W,F as Z,q as T,s as ee}from"./index-BsPqOMQd.js";import{P as ae,F as le,_ as te}from"./FileService-1V_gCAOp.js";import{i as h,a as oe,b as ne,c as se,d as ue,V as re}from"./VForm-qTyrkvYC.js";import{a as q,V as ie,b as F}from"./VSelect-CS-N2192.js";import{V as b,a as me,b as d,c as I,e as ce,d as de}from"./VTextField-DwuoFuJb.js";class pe{constructor(){x(this,"http");const o="http://174.138.178.198:8090/api";this.http=q.create({baseURL:o,headers:{"Content-Type":"application/json"}})}async store(o){const s={secuencia:o.paymentId,monto:o.paymentAmount,fecha_pago:o.paymentDate,image_url:o.fileId,id_postulante:o.postulantId};return(await this.http.post("/pago",s)).data}async updateImageUrl(o,s){return(await this.http.put(`/update-image-url/${o}`,{imageUrl:s})).data}}const ve=T("small",null," Voucher ",-1),fe=T("small",null," Ejemplo",-1),ge={key:0,class:"text-error ms-2"},ye=T("small",null,"Ya inicio la preinscripcion",-1),Ve=T("p",null,"Ya inicio la preinscripcion, desea continuar?",-1),_e=$({__name:"PostulantVoucher",emits:["onSuccess"],setup(i,{emit:o}){const s=X(),u=m(!1),p=new ae,g=new pe,L=new le,C=m(null),N=m(!1),v=m(!1),y=m(""),M=[{id:"001",name:"DOCUMENTO NACIONAL DE IDENTIDAD",shortName:"DNI"},{id:"004",name:"CARNET/CARNÉ DE EXTRANJERÍA",shortName:"CE"}],E=m(null),l=m({documentType:"001",documentNumber:"",paymentId:"",paymentDate:"",paymentAmount:"",paymentVoucher:null,postulantId:null,fileId:null}),f=m(""),O=r=>(f.value="",r?["image/jpeg","image/png","image/jpg","image/gif","image/svg","image/webp"].includes(r.type)?r.size>2e6?"El tamaño de la imagen no debe superar los 2MB":"":"Solo se permiten archivos de imagen (jpeg, png)":"El archivo es requerido"),k=async r=>{if(y.value="",r.length===8&&l.value.documentType==="001"){let e=await p.searchPostulantByDocument(l.value.documentType,r);e&&(y.value=e,v.value=!0)}else if(r.length===12&&l.value.documentType==="004"){let e=await p.searchPostulantByDocument(l.value.documentType,r);e&&(y.value=e,v.value=!0)}},Y=()=>{s.push(`/convocatoria-2024/preinscripcion/${y.value}`)},z=async()=>{const{valid:r}=await E.value.validate();if(l.value.paymentVoucher===null){f.value="El archivo es requerido";return}if(f.value=O(l.value.paymentVoucher),!!r){u.value=!0;try{let e=await p.startPreinscription(l.value);if(e.error){console.log(e),u.value=!1;return}l.value.postulantId=e.id;let n=await L.store(l.value);if(n.error){console.log(n),u.value=!1,S();return}l.value.fileId=n.FileId;let V=await g.updateImageUrl(e.paymentId,n.Path);if(V.error){console.log(V),S(),u.value=!1;return}console.log(V),V!==!0?(u.value=!1,S()):(u.value=!1,s.push(`/convocatoria-2024/preinscripcion/${l.value.postulantId}`))}catch(e){u.value=!1,console.log(e)}}},S=()=>{console.log("rollback",l.value),console.log("rollback")};return(r,e)=>(w(),A(Z,null,[a(re,{ref_key:"formRef",ref:E,onSubmit:W(z,["prevent"])},{default:t(()=>[a(b,{"max-width":"450",class:"mx-auto my-5",rounded:"lg",elevation:"2"},{default:t(()=>[a(B,null,{default:t(()=>[a(me,{class:"mt-2"},{default:t(()=>[a(d,{cols:"12",md:"4"},{default:t(()=>[a(ie,{modelValue:l.value.documentType,"onUpdate:modelValue":[e[0]||(e[0]=n=>l.value.documentType=n),e[1]||(e[1]=n=>k(l.value.documentNumber))],items:M,label:"Tipo de documento","item-title":"shortName","item-value":"id",rules:[c(h)],density:"compact"},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"8",class:"pb-0"},{default:t(()=>[a(I,{modelValue:l.value.documentNumber,"onUpdate:modelValue":[e[2]||(e[2]=n=>l.value.documentNumber=n),k],label:"N° de documento",required:"",rules:[l.value.documentType==="001"?c(oe):c(ne)],autocomplete:"off",counter:l.value.documentType==="001"?8:12,maxLength:l.value.documentType==="001"?8:12},null,8,["modelValue","rules","counter","maxLength"])]),_:1}),a(d,{cols:"12",md:"12"},{default:t(()=>[a(I,{modelValue:l.value.paymentId,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.paymentId=n),label:"Serie",rules:[c(h),c(se)]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"12"},{default:t(()=>[a(I,{modelValue:l.value.paymentDate,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.paymentDate=n),label:"Fecha",type:"date",rules:[c(h)]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"12"},{default:t(()=>[a(I,{modelValue:l.value.paymentAmount,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.paymentAmount=n),label:"Monto",rules:[c(h),c(ue)]},null,8,["modelValue","rules"])]),_:1}),a(d,{cols:"12",md:"12"},{default:t(()=>[a(G,{density:"compact"},{default:t(()=>[a(K,null,{default:t(()=>[ve]),_:1}),a(R),a(_,{"prepend-icon":"mdi-information-variant-circle-outline",density:"compact",onClick:e[6]||(e[6]=n=>N.value=!0)},{default:t(()=>[fe]),_:1})]),_:1}),a(b,{variant:"tonal",rounded:"0"},{default:t(()=>[a(te,{"aspect-ratio":1,onOnCropper:e[7]||(e[7]=n=>(C.value=n.blob,l.value.paymentVoucher=n.file))}),C.value?(w(),j(U,{key:0,"aspect-ratio":16/9,src:C.value,height:"250",class:"border"},null,8,["src"])):P("",!0)]),_:1}),f.value?(w(),A("small",ge,Q(f.value),1)):P("",!0)]),_:1}),a(d,{cols:"12"},{default:t(()=>[a(_,{type:"submit",variant:"flat",block:"",loading:u.value},{default:t(()=>[D(" Iniciar preinscripción ")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),a(F,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=n=>N.value=n)},{default:t(()=>[a(b,{width:"300px",class:"mx-auto"},{default:t(()=>[a(U,{src:"http://www.osce.gob.pe/consultasenlinea/rnp/images/ClaveBANBIF.gif"})]),_:1})]),_:1},8,["modelValue"]),a(F,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=n=>v.value=n)},{default:t(()=>[a(b,{width:"300px",class:"mx-auto"},{default:t(()=>[a(ce,{class:"bg-primary"},{default:t(()=>[ye]),_:1}),a(B,null,{default:t(()=>[Ve]),_:1}),a(de,null,{default:t(()=>[a(_,{color:"red",onClick:e[9]||(e[9]=n=>v.value=!1)},{default:t(()=>[D("No")]),_:1}),a(R),a(_,{variant:"tonal",onClick:Y},{default:t(()=>[D("Si")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});class he{constructor(){x(this,"http");const o="http://174.138.178.198:8090/api";this.http=q.create({baseURL:o,headers:{"Content-Type":"application/json"}})}async getCallBySlug(o){return(await this.http.get(`get-call-by-slug/${o}`)).data}}const Se=$({__name:"index",setup(i){const o=ee(),s=new he;return(async()=>{let p=o.params.slug,g=await s.getCallBySlug(p);console.log(g)})(),(p,g)=>(w(),j(_e))}});export{Se as default};
